<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Re Solution - GestÃ£o Financeira</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

        :root {
            --bg-body: #f8fafc;
            --bg-card: #ffffff;
            --text-main: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --input-bg: #ffffff;
            --primary-color: #2563eb;
            --success-color: #10b981;
            --danger-color: #ef4444;
        }

        body.dark-mode {
            --bg-body: #0f172a;
            --bg-card: #1e293b;
            --text-main: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #334155;
            --input-bg: #1e293b;
        }

        body { font-family: 'Inter', sans-serif; background-color: var(--bg-body); color: var(--text-main); margin: 0; }

        .topo-titulo {
            display: flex; align-items: center; padding: 1rem 2rem;
            background: var(--bg-card); border-bottom: 1px solid var(--border-color);
        }

        .controles-topo { margin-left: auto; display: flex; align-items: center; gap: 8px; }

        .layout { display: grid; grid-template-columns: 280px 1fr; gap: 1.5rem; padding: 1.5rem; }

        @media (max-width: 1024px) {
            .layout { grid-template-columns: 1fr; }
            .lateral {
                position: fixed; top: 0; left: -300px; width: 260px; height: 100%;
                z-index: 1000; background: var(--bg-card); padding: 20px;
                transition: 0.3s ease; box-shadow: 5px 0 15px rgba(0,0,0,0.2);
            }
            .lateral.active { left: 0; }
            .btn-menu-mobile { display: block !important; }
        }

        .btn-menu-mobile { display: none; font-size: 1.5rem; background: none; border: none; cursor: pointer; color: var(--primary-color); }

        .card { 
            background: var(--bg-card); padding: 1.2rem; border-radius: 12px; 
            border: 1px solid var(--border-color); margin-bottom: 10px;
            border-left: 5px solid var(--primary-color); transition: transform 0.2s;
        }
        .card span { display: block; font-size: 1.6rem; font-weight: 800; margin-top: 0.4rem; }

        .secao-form { background: var(--bg-card); padding: 1.5rem; border-radius: 16px; border: 1px solid var(--border-color); margin-bottom: 1.5rem; }
        .actions { display: flex; flex-wrap: wrap; gap: 10px; }
        .actions input, .actions select { height: 42px; padding: 0 12px; border-radius: 10px; border: 1px solid var(--border-color); background: var(--input-bg); color: var(--text-main); }
        
        #btnSalvar { background: linear-gradient(135deg, #2563eb, #1d4ed8); color: white; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; flex: 1; }

        .container-tabelas { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        .tabela-box { background: var(--bg-card); padding: 1.2rem; border-radius: 12px; border: 1px solid var(--border-color); }
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        th { text-align: left; padding: 10px; color: var(--text-secondary); border-bottom: 2px solid var(--border-color); font-size: 0.7rem; }
        td { padding: 10px; border-bottom: 1px solid var(--border-color); }
        
        #bannerAlerta { display: none; background: var(--danger-color); color: white; text-align: center; padding: 10px; font-weight: bold; }
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; }
        #overlay.active { display: block; }

        /* Estilo para a legenda personalizada */
        .legenda-item { display: flex; align-items: center; justify-content: space-between; font-size: 0.8rem; margin-bottom: 5px; }
        .legenda-cor { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 8px; }
    </style>
</head>
<body>
<div id="overlay" onclick="toggleMenu()"></div>

<div class="topo-titulo">
    <button class="btn-menu-mobile" onclick="toggleMenu()">â˜°</button>
    <div style="display: flex; align-items: center; gap: 5px;">
        <span style="font-weight: 800; color: var(--primary-color);">RE SOLUTION</span>
        <span id="labelMesAtivo" style="color: var(--text-secondary); font-size: 0.9rem;">â€” JAN/2026</span>
    </div>
    <div class="controles-topo">
        <button id="btnDarkMode" onclick="toggleDarkMode()" style="background:none; border:none; font-size:1.2rem; cursor:pointer;">ğŸŒ™</button>
    </div>
</div>

<div id="bannerAlerta">ğŸ”” ATENÃ‡ÃƒO: Contas vencendo hoje ou atrasadas!</div>

<div class="layout">
    <div class="lateral" id="menuLateral">
        <div class="card" style="border-left-color: var(--success-color);">Recebido<span id="totalRecebido" style="color:var(--success-color)">R$ 0,00</span></div>
        <div class="card" style="border-left-color: var(--danger-color);">Pago<span id="totalPago" style="color:var(--danger-color)">R$ 0,00</span></div>
        <div class="card" style="border-left-color: var(--primary-color);">Saldo<span id="saldo" style="color:var(--primary-color)">R$ 0,00</span></div>
        
        <div class="card" style="margin-top: 15px; border-left: none;">
            <canvas id="graficoPizza"></canvas>
            <div id="legendaGrafico" style="margin-top: 15px;"></div>
        </div>

        <select id="mes" onchange="mudarMes()" style="width: 100%; margin-top: 20px;">
            <option value="2026-01">Janeiro/2026</option>
            <option value="2026-02">Fevereiro/2026</option>
            <option value="2026-03">MarÃ§o/2026</option>
            <option value="2026-04">Abril/2026</option>
            <option value="2026-05">Maio/2026</option>
            <option value="2026-06">Junho/2026</option>
            <option value="2026-07">Julho/2026</option>
            <option value="2026-08">Agosto/2026</option>
            <option value="2026-09">Setembro/2026</option>
            <option value="2026-10">Outubro/2026</option>
            <option value="2026-11">Novembro/2026</option>
            <option value="2026-12">Dezembro/2026</option>
        </select>
    </div>

    <div class="principal">
        <div class="secao-form">
            <div class="actions">
                <select id="tipo"><option value="receber">Receber</option><option value="pagar">Pagar</option></select>
                <select id="categoria">
                    <option value="Supermercado">ğŸ›’ Supermercado</option>
                    <option value="AlimentaÃ§Ã£o">ğŸ” AlimentaÃ§Ã£o</option>
                    <option value="Transporte">ğŸš— Transporte</option>
                    <option value="Lazer">ğŸ‰ Lazer</option>
                    <option value="Gastos Pessoais">ğŸ’†â€â™‚ï¸ Gastos Pessoais</option>
                    <option value="SaÃºde">ğŸ©º SaÃºde e bem-estar</option>
                    <option value="Credito">ğŸ’² Credito</option>
                    <option value="Filho">ğŸ§’ Filho</option>
                    <option value="Moradia">ğŸ  Moradia</option>
                    <option value="Assinaturas">ğŸ“º Assinaturas</option>
                    <option value="Emprestimos">ğŸ’¸ Emprestimos</option>
                    <option value="Vale AlimentaÃ§Ã£o">ğŸ’³ Vale AlimentaÃ§Ã£o</option>
                    <option value="Mensalidades">ğŸ’ª Mensalidades</option>
                    <option value="Reserva">ğŸ§¾ Reserva</option>
                    <option value="SalÃ¡rio">ğŸ’° SalÃ¡rio</option>
                    <option value="Outros">âš™ï¸ Outros</option>
                </select>
                <input id="descricao" placeholder="Disc." style="flex:2">
                <input id="valor" type="number" placeholder="R$">
                <input id="data" type="date">
                <button id="btnSalvar" onclick="adicionar()">Adicionar</button>
            </div>
        </div>

        <div class="container-tabelas">
            <div class="tabela-box">
                <h3>ğŸ“ˆ Recebimentos</h3>
                <table>
                    <thead><tr><th>Disc.</th><th>Valor</th><th>Ok</th></tr></thead>
                    <tbody id="tabelaReceber"></tbody>
                </table>
            </div>
            <div class="tabela-box">
                <h3>ğŸ“‰ Pagamentos</h3>
                <table>
                    <thead><tr><th>Disc.</th><th>Valor</th><th>Ok</th></tr></thead>
                    <tbody id="tabelaPagar"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
let dadosPorMes = JSON.parse(localStorage.getItem('financeiroDados2026') || '{}');
let mesAtual = localStorage.getItem('mesSelecionado') || '2026-01';
document.getElementById('mes').value = mesAtual;

function salvar(){ localStorage.setItem('financeiroDados2026', JSON.stringify(dadosPorMes)); }
function garantirMes(){ if(!dadosPorMes[mesAtual]) dadosPorMes[mesAtual] = { receber: [], pagar: [] }; }
function formatar(v) { return v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }); }

function mudarMes() {
    mesAtual = document.getElementById('mes').value;
    localStorage.setItem('mesSelecionado', mesAtual);
    render();
}

function toggleDarkMode() {
    const isDark = document.body.classList.toggle('dark-mode');
    document.getElementById('btnDarkMode').innerText = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
    localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled');
    render();
}

function adicionar(){
    const tipo = document.getElementById('tipo').value;
    const descricao = document.getElementById('descricao').value;
    const valor = Number(document.getElementById('valor').value);
    const data = document.getElementById('data').value;
    const categoria = document.getElementById('categoria').value;
    if(!descricao || !valor) return alert("Preencha os campos!");

    garantirMes();
    dadosPorMes[mesAtual][tipo].push({descricao, valor, data, categoria, marcado: false});
    salvar(); render();
}

function render() {
    garantirMes();
    const tRec = document.getElementById('tabelaReceber');
    const tPag = document.getElementById('tabelaPagar');
    const banner = document.getElementById('bannerAlerta');
    tRec.innerHTML = ''; tPag.innerHTML = '';
    
    let totalRec = 0, totalPag = 0, urgente = false;
    const hoje = new Date().toISOString().split('T')[0];

    ['receber', 'pagar'].forEach(tipo => {
        dadosPorMes[mesAtual][tipo].forEach((item, i) => {
            if(item.marcado) { if(tipo === 'receber') totalRec += item.valor; else totalPag += item.valor; }
            if(tipo === 'pagar' && !item.marcado && item.data <= hoje && item.data !== "") urgente = true;

            const html = `<tr>
                <td>${item.descricao}<br><small style="color:var(--text-secondary)">${item.categoria}</small></td>
                <td>${formatar(item.valor)}</td>
                <td><input type="checkbox" ${item.marcado?'checked':''} onchange="toggle('${tipo}',${i})"></td>
            </tr>`;
            if(tipo === 'receber') tRec.innerHTML += html; else tPag.innerHTML += html;
        });
    });

    banner.style.display = urgente ? 'block' : 'none';
    document.getElementById('totalRecebido').innerText = formatar(totalRec);
    document.getElementById('totalPago').innerText = formatar(totalPag);
    document.getElementById('saldo').innerText = formatar(totalRec - totalPag);
    atualizarGrafico();
}

function toggle(tipo, i){ dadosPorMes[mesAtual][tipo][i].marcado = !dadosPorMes[mesAtual][tipo][i].marcado; salvar(); render(); }

function atualizarGrafico(){
    const resumo = {};
    const cores = ['#2563eb','#10b981','#ef4444','#f59e0b','#8b5cf6','#ec4899'];
    
    if (dadosPorMes[mesAtual].pagar) {
        dadosPorMes[mesAtual].pagar.forEach(item => { 
            if(item.marcado) { resumo[item.categoria] = (resumo[item.categoria] || 0) + item.valor; }
        });
    }

    const ctx = document.getElementById('graficoPizza');
    const legendaContainer = document.getElementById('legendaGrafico');
    if(window.meuGrafico) window.meuGrafico.destroy();
    legendaContainer.innerHTML = '';

    if(Object.keys(resumo).length === 0) return;

    window.meuGrafico = new Chart(ctx, {
        type: 'doughnut', 
        data: {
            labels: Object.keys(resumo),
            datasets: [{ 
                data: Object.values(resumo), 
                backgroundColor: cores, 
                borderWidth: 2,
                borderColor: document.body.classList.contains('dark-mode') ? '#1e293b' : '#ffffff' 
            }]
        },
        options: { cutout: '75%', maintainAspectRatio: true, aspectRatio: 2, plugins: { legend: { display: false } } }
    });

    Object.keys(resumo).forEach((cat, i) => {
        const item = document.createElement('div');
        item.className = 'legenda-item';
        item.innerHTML = `<div><i class="legenda-cor" style="background:${cores[i%cores.length]}"></i>${cat}</div><b>${formatar(resumo[cat])}</b>`;
        legendaContainer.appendChild(item);
    });
}

function toggleMenu() {
    document.getElementById('menuLateral').classList.toggle('active');
    document.getElementById('overlay').classList.toggle('active');
}

render();
</script>
</body>
</html>
